<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Snake Game</title>
	<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>
body {
  margin: 0;
  background: linear-gradient(135deg, #240046, #3c096c);
  font-family: 'Orbitron', sans-serif;
  color: white;
  overflow-x: hidden;
  min-height: 100vh;
}

#game-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding-top: 30px;
}

.game-canvas {
  border: 4px solid #9d4edd;
  box-shadow: 0 0 20px #c77dff;
  background-color: #1a1a1a;
  max-width: 90vw;
  max-height: 90vw;
  width: 100%;
  aspect-ratio: 1;
}

.keys {
  text-align: center;
  padding: 20px;
  margin-top: 20px;
}

.arr {
  display: inline-block;
  width: 70px;
  height: 70px;
  background: #3a0ca3;
  border-radius: 12px;
  margin: 10px;
  box-shadow: 0 0 12px #7209b7;
  transition: all 0.2s ease;
  cursor: pointer;
  position: relative;
}

.arr:hover {
  background: #4cc9f0;
  box-shadow: 0 0 15px #4cc9f0;
}

.chevron::before {
  content: '';
  display: inline-block;
  width: 20px;
  height: 20px;
  border-style: solid;
  border-width: 8px 8px 0 0;
  border-color: white;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.chevron.up::before {
  transform: translate(-50%, -50%) rotate(-45deg);
}

.chevron.down::before {
  transform: translate(-50%, -50%) rotate(135deg);
}

.chevron.left::before {
  transform: translate(-50%, -50%) rotate(225deg);
}

.chevron.right::before {
  transform: translate(-50%, -50%) rotate(45deg);
}
@media (min-width: 768px) {
    #content {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }
    
    #posts {
        width: 68%;
    }
    
    #right-side {
        width: 30%;
        margin-top: 0;
    }
}

@media (min-width: 992px) {
    #header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 50px;
    }
    
    #menu {
        margin-top: 0;
    }
    
    #content {
        padding: 20px 50px;
    }
}
@media (max-width: 767px) {
    .arr {
        width: 50px;
        height: 50px;
    }
    
    .chevron::before {
        width: 15px;
        height: 15px;
        border-width: 6px 6px 0 0;
    }
    
    .chevron.up::before {
        transform: translate(-50%, -50%) rotate(-45deg);
    }
    
    .chevron.down::before {
        transform: translate(-50%, -50%) rotate(135deg);
    }
    
    .chevron.left::before {
        transform: translate(-50%, -50%) rotate(225deg);
    }
    
    .chevron.right::before {
        transform: translate(-50%, -50%) rotate(45deg);
    }
}
</style>
</head>
<body>
	<div id="game-container">
		<canvas id="gc" class="game-canvas" width="400" height="400"></canvas>
	</div>
	<div class="keys">
	  <a class="up arr" onclick="Snake.action('up')">
	    <i class="chevron up"></i></a>
	  <br />
	  <a class="left arr" onclick="Snake.action('left')">
	    <i class="chevron left"></i></a>
	  <a class="down arr" onclick="Snake.action('down')">
	    <i class="chevron down"></i></a>
	  <a class="right arr" onclick="Snake.action('right')">
	    <i class="chevron right"></i></a>
	</div>
	<script>
		var Snake = (function () {

  const INITIAL_TAIL = 4;
  var fixedTail = true;

  var intervalID;

  var tileCount = 10;
  var gridSize = 400/tileCount;

  const INITIAL_PLAYER = { x: Math.floor(tileCount / 2), y: Math.floor(tileCount / 2) };

  var velocity = { x:0, y:0 };
  var player = { x: INITIAL_PLAYER.x, y: INITIAL_PLAYER.y };

  var walls = false;

  var fruit = { x:1, y:1 };

  var trail = [];
  var tail = INITIAL_TAIL;

  var reward = 0;
  var points = 0;
  var pointsMax = 0;

  var ActionEnum = { 'none':0, 'up':1, 'down':2, 'left':3, 'right':4 };
  Object.freeze(ActionEnum);
  var lastAction = ActionEnum.none;

  function setup () {
    canv = document.getElementById('gc');
    ctx = canv.getContext('2d');

    game.reset()
    if (!snakeImg.complete || !fruitImg.complete || !headImg.complete) return;

  }

  var game = {

    reset: function () {
      ctx.fillStyle = 'grey';
      ctx.fillRect(0, 0, canv.width, canv.height);

      tail = INITIAL_TAIL;
      points = 0;
      velocity.x = 0;
      velocity.y = 0;
      player.x = INITIAL_PLAYER.x;
      player.y = INITIAL_PLAYER.y;
      // this.RandomFruit();
      reward = -1;

      lastAction = ActionEnum.none;

      trail = [];
      trail.push({ x: player.x, y: player.y });
      // for(var i=0; i<tail; i++) trail.push({ x: player.x, y: player.y });
    },

    action: {
      up: function () {
        if (lastAction != ActionEnum.down){
          velocity.x = 0;
          velocity.y = -1;
        }
      },
      down: function () {
        if (lastAction != ActionEnum.up){
          velocity.x = 0;
          velocity.y = 1;
        }
      },
      left: function () {
        if (lastAction != ActionEnum.right){
          velocity.x = -1;
          velocity.y = 0;
        }
      },
      right: function () {
        if (lastAction != ActionEnum.left){
          velocity.x = 1;
          velocity.y = 0;
        }
      }
    },

    RandomFruit: function () {
      if(walls){
        fruit.x = 1+Math.floor(Math.random() * (tileCount-2));
        fruit.y = 1+Math.floor(Math.random() * (tileCount-2));
      }
      else {
        fruit.x = Math.floor(Math.random() * tileCount);
        fruit.y = Math.floor(Math.random() * tileCount);
      }
    },

    log: function () {
      console.log('====================');
      console.log('x:' + player.x + ', y:' + player.y);
      console.log('tail:' + tail + ', trail.length:' + trail.length);
    },

    loop: function () {

      reward = -0.1;

      function DontHitWall () {
        if(player.x < 0) player.x = tileCount-1;
        if(player.x >= tileCount) player.x = 0;
        if(player.y < 0) player.y = tileCount-1;
        if(player.y >= tileCount) player.y = 0;
      }
      function HitWall () {
        if(player.x < 1) game.reset();
        if(player.x > tileCount-2) game.reset();
        if(player.y < 1) game.reset();
        if(player.y > tileCount-2) game.reset();

        ctx.fillStyle = 'grey';
        ctx.fillRect(0,0,gridSize-1,canv.height);
        ctx.fillRect(0,0,canv.width,gridSize-1);
        ctx.fillRect(canv.width-gridSize+1,0,gridSize,canv.height);
        ctx.fillRect(0, canv.height-gridSize+1,canv.width,gridSize);
      }

      var stopped = velocity.x == 0 && velocity.y == 0;

      player.x += velocity.x;
      player.y += velocity.y;

      if (velocity.x == 0 && velocity.y == -1) lastAction = ActionEnum.up;
      if (velocity.x == 0 && velocity.y == 1) lastAction = ActionEnum.down;
      if (velocity.x == -1 && velocity.y == 0) lastAction = ActionEnum.left;
      if (velocity.x == 1 && velocity.y == 0) lastAction = ActionEnum.right;

      ctx.fillStyle = 'rgba(40,40,40,0.8)';
      ctx.fillRect(0,0,canv.width,canv.height);

      if(walls) HitWall();
      else DontHitWall();

      // game.log();

      if (!stopped){
        trail.push({x:player.x, y:player.y});
        while(trail.length > tail) trail.shift();
      }

      if(!stopped) {
        ctx.fillStyle = 'rgba(200,200,200,0.2)';
        ctx.font = "small-caps 14px Helvetica";
        ctx.fillText("(esc) reset", 24, 356);
        ctx.fillText("(space) pause", 24, 374);
      }

     for (var i = 0; i < trail.length - 1; i++) {
  ctx.drawImage(snakeImg, trail[i].x * gridSize, trail[i].y * gridSize, gridSize, gridSize);
}

// Cabeça da cobra (último item do rastro)
ctx.drawImage(headImg.complete ? headImg : snakeImg, trail[trail.length - 1].x * gridSize, trail[trail.length - 1].y * gridSize, gridSize, gridSize);


      if (player.x == fruit.x && player.y == fruit.y) {
        if(!fixedTail) tail++;
        points++;
        if(points > pointsMax) pointsMax = points;
        reward = 1;
        game.RandomFruit();
        // make sure new fruit didn't spawn in snake tail
        while((function () {
          for(var i=0; i<trail.length; i++) {
            if (trail[i].x == fruit.x && trail[i].y == fruit.y) {
              game.RandomFruit();
              return true;
            }
          }
          return false;
        })());
      }

     ctx.drawImage(fruitImg, fruit.x * gridSize, fruit.y * gridSize, gridSize, gridSize);


      if(stopped) {
        ctx.fillStyle = 'rgba(250,250,250,0.8)';
        ctx.font = "small-caps bold 14px Helvetica";
        ctx.fillText("press ARROW KEYS to START...", 24, 374);
      }

      ctx.fillStyle = 'white';
      ctx.font = "bold small-caps 16px Helvetica";
      ctx.fillText("points: " + points, 288, 40);
      ctx.fillText("top: " + pointsMax, 292, 60);

      return reward;
    }
  }

  function keyPush (evt) {
    switch(evt.keyCode) {
      case 37: //left
      game.action.left();
      evt.preventDefault();
      break;

      case 38: //up
      game.action.up();
      evt.preventDefault();
      break;

      case 39: //right
      game.action.right();
      evt.preventDefault();
      break;

      case 40: //down
      game.action.down();
      evt.preventDefault();
      break;

      case 32: //space
      Snake.pause();
      evt.preventDefault();
      break;

      case 27: //esc
      game.reset();
      evt.preventDefault();
      break;
    }
  }

  return {
    start: function (fps = 15) {
      window.onload = setup;
      intervalID = setInterval(game.loop, 1000 / fps);
    },

    loop: game.loop,

    reset: game.reset,

    stop: function () {
      clearInterval(intervalID);
    },

    setup: {
      keyboard: function (state) {
        if (state) {
          document.addEventListener('keydown', keyPush);
        } else {
          document.removeEventListener('keydown', keyPush);
        }
      },
      wall: function (state) {
        walls = state;
      },
      tileCount: function (size) {
        tileCount = size;
        gridSize = 400 / tileCount;
      },
      fixedTail: function (state) {
        fixedTail = state;
      }
    },

    action: function (act) {
      switch(act) {
        case 'left':
          game.action.left();
          break;

        case 'up':
          game.action.up();
          break;

        case 'right':
          game.action.right();
          break;

        case 'down':
          game.action.down();
          break;
      }
    },

    pause: function () {
      velocity.x = 0;
      velocity.y = 0;
    },

    clearTopScore: function () {
      pointsMax = 0;
    },

    data: {
      player: player,
      fruit: fruit,
      trail: function () {
        return trail;
      }
    },

    info: {
      tileCount: tileCount
    }
  };

})();
// carregar imagens
const snakeImg = new Image();
snakeImg.src = 'snake.png';  // corpo da cobra

const fruitImg = new Image();
fruitImg.src = 'fruit.png';  // maçã

const headImg = new Image();
headImg.src  = 'head.jpg';  // cabeça diferente


let imagesLoaded = 0;
const totalImages = 3;

function checkStart() {
  imagesLoaded++;
  if (imagesLoaded === totalImages) {
    Snake.start(8);
    Snake.setup.keyboard(true);
    Snake.setup.fixedTail(false);
  }
}

snakeImg.onload = checkStart;
fruitImg.onload = checkStart;
headImg.onload = checkStart;

	</script>
</body>
</html>